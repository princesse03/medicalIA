<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyse des Symptômes</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="icon" href="iQmg/core-img/favicon.ico">
    <link rel="stylesheet" href="{{url_for('static', filename='core-style.css')}}">

</head>
<body class="bg-light">

    <div class="container mt-5">
        <div class="card shadow p-4">
            <h2 class="text-center text-primary mb-4">Analyse Complète des Symptômes</h2>
            <form id="symptomsForm" method="POST" action="{{url_for('testons')}}">

                <!-- Section Informations Générales -->
                <div class="symptom-section">
                    <h3 class="section-title">Informations Générales</h3>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Âge</label>
                            <input type="number" class="form-control" name="Age" required>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Genre</label>
                            <select class="form-select" name="Genre">
                                <option value="homme">Homme</option>
                                <option value="femme">Femme</option>
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Tension artérielle</label>
                            <select class="form-select" name="Tension_arterielle">
                                <option value="bas">Bas</option>
                                <option value="normale" selected>Normale</option>
                                <option value="elevee">Élevée</option>
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Niveau de cholestérol</label>
                            <select class="form-select" name="Niveau_Cholesterol">
                                <option value="bas">Bas</option>
                                <option value="normal" selected>Normal</option>
                                <option value="eleve">Élevé</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Section Symptômes Généraux -->
                <div class="symptom-section">
                    <h3 class="section-title">Symptômes Généraux</h3>
                    <div class="symptom-group">
                        {% for symptom in ['Fievre', 'Fatigue', 'Perte_poids', 'Tristesse', 'Soif_intense', 'Frissons'] %}
                        <div class="symptom-item form-check">
                            <input class="form-check-input" type="checkbox" name="{{ symptom.lower() }}" value="1">
                            <label class="form-check-label">{{ symptom.replace('_', ' ') }}</label>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Section Symptômes Respiratoires -->
                <div class="symptom-section">
                    <h3 class="section-title">Symptômes Respiratoires</h3>
                    <div class="symptom-group">
                        {% for symptom in ['Toux', 'Difficulte_respiratoire', 'Nez_bouche', 'Eternuements', 'Sifflements', 'Expectorations', 'Essoufflement'] %}
                        <div class="symptom-item form-check">
                            <input class="form-check-input" type="checkbox" name="{{ symptom.lower() }}" value="1">
                            <label class="form-check-label">{{ symptom.replace('_', ' ') }}</label>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Section Symptômes Neurologiques -->
                <div class="symptom-section">
                    <h3 class="section-title">Symptômes Neurologiques</h3>
                    <div class="symptom-group">
                        {% for symptom in ['Maux_de_tete', 'Raideur', 'Tremblements', 'Paralysie_faciale', 'Trouble_parole'] %}
                        <div class="symptom-item form-check">
                            <input class="form-check-input" type="checkbox" name="{{ symptom.lower() }}" value="1">
                            <label class="form-check-label">{{ symptom.replace('_', ' ') }}</label>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Section Symptômes Digestifs -->
                <div class="symptom-section">
                    <h3 class="section-title">Symptômes Digestifs</h3>
                    <div class="symptom-group">
                        {% for symptom in ['Douleur_abdominale', 'Nausees', 'Diarrhee', 'Saignements_rectaux'] %}
                        <div class="symptom-item form-check">
                            <input class="form-check-input" type="checkbox" name="{{ symptom.lower() }}" value="1">
                            <label class="form-check-label">{{ symptom.replace('_', ' ') }}</label>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Section Symptômes Cutanés -->
                <div class="symptom-section">
                    <h3 class="section-title">Symptômes Cutanés</h3>
                    <div class="symptom-group">
                        {% for symptom in ['Demangeaisons', 'Rougeurs', 'Plaques', 'Desquamation', 'Cicatrisation_lente', 'Jaunisse'] %}
                        <div class="symptom-item form-check">
                            <input class="form-check-input" type="checkbox" name="{{ symptom.lower() }}" value="1">
                            <label class="form-check-label">{{ symptom.replace('_', ' ') }}</label>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Section Autres Symptômes -->
                <div class="symptom-section">
                    <h3 class="section-title">Autres Symptômes</h3>
                    <div class="symptom-group">
                        {% for symptom in ['Courbatures', 'Palpitations', 'Gonflement_ganglions', 'Sueurs_nocturnes', 'Sang_urines', 'Douleur_thoracique', 'Brulures_urinaires', 'Fractures_frequentes'] %}
                        <div class="symptom-item form-check">
                            <input class="form-check-input" type="checkbox" name="{{ symptom.lower() }}" value="1">
                            <label class="form-check-label">{{ symptom.replace('_', ' ') }}</label>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <div class="d-grid gap-2 mt-4">
                    <button type="submit" class="btn btn-primary btn-lg">Lancer l'Analyse Médicale</button>
                </div>
            </form>

            {% if resultat %}
<div class="mt-4 p-4 rounded" style="background-color: #f8f9fa; border-left: 5px solid {% if resultat.couleur == 'red' %}#dc3545{% elif resultat.couleur == 'yellow' %}#ffc107{% elif resultat.couleur == 'green' %}#198754{% else %}#0dcaf0{% endif %}">
    <h3 class="text-center mb-4">Résultats du Diagnostic</h3>

    <div class="alert {% if resultat.couleur == 'red' %}alert-danger{% elif resultat.couleur == 'yellow' %}alert-warning{% elif resultat.couleur == 'green' %}alert-success{% else %}alert-info{% endif %}">
        <h4>{{ resultat.maladie }}</h4>
        <p>Probabilité: {{ (resultat.probabilite * 100)|round(1) }}%</p>
        <p><strong>{{ resultat.message }}</strong></p>
    </div>

    {% if resultat.top_5 %}
    <div class="mb-4">
        <h5>Top 5 des diagnostics possibles:</h5>
        <ul class="list-group">
            {% for maladie, proba in resultat.top_5 %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
                {{ maladie }}
                <span class="badge bg-primary rounded-pill">{{ (proba * 100)|round(1) }}%</span>
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <div class="mb-4">
        <h5>Recommandations:</h5>
        <ul class="list-group">
            {% for conseil in resultat.conseils %}
            <li class="list-group-item">{{ conseil }}</li>
            {% endfor %}
        </ul>
    </div>

    {% if resultat.urgence == "immédiate" %}
    <div class="alert alert-danger text-center fw-bold fs-4">
        <i class="bi bi-exclamation-triangle-fill">URGENCE MÉDICALE - COMPOSEZ LE 15 IMMÉDIATEMENT</i>
    </div>
    {% endif %}
</div>
{% endif %}
        </div>
    </div>

    <!-- Footer (identique à votre version originale) -->
    <footer class="footer-area section-padding-100 mt-5">
        <!-- ... Votre code de footer existant ... -->
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Script pour améliorer l'expérience utilisateur
        document.addEventListener('DOMContentLoaded', function() {
            // Ajoute une classe active aux éléments cochés pour un meilleur feedback visuel
            const checkboxes = document.querySelectorAll('.form-check-input');
            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    if(this.checked) {
                        this.parentElement.classList.add('active');
                    } else {
                        this.parentElement.classList.remove('active');
                    }
                });
            });
        });
    </script>
<script>
    function jouerSon() {
        const audio = document.getElementById('notif-audio');
        if (audio) {
            audio.currentTime = 0;
            audio.play();
        }
    }

    function parler(texte) {
        jouerSon(); // jouer le son avant de parler
        const synth = window.speechSynthesis;
        const utterance = new SpeechSynthesisUtterance(texte);
        utterance.lang = 'fr-FR';
        synth.speak(utterance);
    }

    function lireResultat() {
        const resultatDiv = document.querySelector('.alert h4');
        const proba = document.querySelector('.alert p');
        const message = document.querySelector('.alert strong');

        if (resultatDiv && proba && message) {
            const texte = `Diagnostic : ${resultatDiv.textContent}.
                           Probabilité : ${proba.textContent}.
                           Message : ${message.textContent}`;
            parler(texte);
        }
    }

    document.addEventListener('DOMContentLoaded', function () {
        const resultatExiste = document.querySelector('.alert');

        if (resultatExiste) {
            // Lecture du diagnostic
            lireResultat();
            // Afficher le bouton de reecoute
            document.getElementById('reecouter-container').style.display = 'block';
        } else {
            // Message d'accueil
            parler("Bienvenue dans MED I A. Veuillez cocher vos symptômes et lancer le diagnostic.");
        }
    });
</script>
</body>
</html>